\withOptions moreSeqRules:on;

\javaSource "../../src";

\chooseContract "de.wiesler.Sorter[de.wiesler.Sorter::sort([I)].JML normal_behavior operation contract.0";

\proofScript "

macro autopilot-prep;

select succedent
    formula='{heapAtPre:=heap || exc:=null || heap:=heapAfter_sort}
               seqPerm(seqDef{int u;}(Z(0(#)), length(values), any::select(heap, values, arr(u))),
                       seqDef{int u;}(Z(0(#)), length(values), any::select(heapAtPre, values, arr(u))))';
macro onestep;

let     @seqPre='seqDef{int u;}(0, values.length,any::select(heap, values,arr(u)))'
       @seqSort='seqDef{int u;}(0, values.length,any::select(heapAfter_sort, values,arr(u)))'
    @seqStorage='seqDef{int u;}(0, values.length,any::select(heapAfter_Storage, values,arr(u)))';

cut '@seqPre = @seqStorage';
rule applyEq formula='seqPerm(@seqSort, @seqPre)' on='@seqPre';

tryclose;

"